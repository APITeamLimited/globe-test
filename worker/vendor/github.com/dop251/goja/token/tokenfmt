#!/usr/bin/env perl

use strict;
use warnings;

my (%token, @order, @keywords);

***REMOVED***
    my $keywords;
    my @const;
    push @const, <<_END_;
package token

const(
    _ Token = iota
_END_

    for (split m/\n/, <<_END_) ***REMOVED***
ILLEGAL
EOF
COMMENT
KEYWORD

STRING
BOOLEAN
NULL
NUMBER
IDENTIFIER

PLUS                            +
MINUS                           -
MULTIPLY                        *
SLASH                           /
REMAINDER                       %

AND                             &
OR                              |
EXCLUSIVE_OR                    ^
SHIFT_LEFT                      <<
SHIFT_RIGHT                     >>
UNSIGNED_SHIFT_RIGHT            >>>
AND_NOT                         &^

ADD_ASSIGN                     +=
SUBTRACT_ASSIGN                -=
MULTIPLY_ASSIGN                *=
QUOTIENT_ASSIGN                /=
REMAINDER_ASSIGN               %=

AND_ASSIGN                     &=
OR_ASSIGN                      |=
EXCLUSIVE_OR_ASSIGN            ^=
SHIFT_LEFT_ASSIGN              <<=
SHIFT_RIGHT_ASSIGN             >>=
UNSIGNED_SHIFT_RIGHT_ASSIGN    >>>=
AND_NOT_ASSIGN                 &^=

LOGICAL_AND                    &&
LOGICAL_OR                     ||
INCREMENT                      ++
DECREMENT                      --

EQUAL                          ==
STRICT_EQUAL                   ===
LESS                           <
GREATER                        >
ASSIGN                         =
NOT                            !

BITWISE_NOT                    ~

NOT_EQUAL                      !=
STRICT_NOT_EQUAL               !==
LESS_OR_EQUAL                  <=
GREATER_OR_EQUAL               <=

LEFT_PARENTHESIS               (
LEFT_BRACKET                   [
LEFT_BRACE                     ***REMOVED***
COMMA                          ,
PERIOD                         .

RIGHT_PARENTHESIS              )
RIGHT_BRACKET                  ]
RIGHT_BRACE                    ***REMOVED***
SEMICOLON                      ;
COLON                          :
QUESTION_MARK                  ?

firstKeyword
IF
IN
DO

VAR
FOR
NEW
TRY

THIS
ELSE
CASE
VOID
WITH

WHILE
BREAK
CATCH
THROW

RETURN
TYPEOF
DELETE
SWITCH

DEFAULT
FINALLY

FUNCTION
CONTINUE
DEBUGGER

INSTANCEOF
lastKeyword
_END_
        chomp;

        next if m/^\s*#/;

        my ($name, $symbol) = m/(\w+)\s*(\S+)?/;

        if (defined $symbol) ***REMOVED***
            push @order, $name;
            push @const, "$name // $symbol";
            $token***REMOVED***$name***REMOVED*** = $symbol;
        ***REMOVED*** elsif (defined $name) ***REMOVED***
            $keywords ||= $name eq 'firstKeyword';

            push @const, $name;
            #$const[-1] .= " Token = iota" if 2 == @const;
            if ($name =~ m/^([A-Z]+)/) ***REMOVED***
                push @keywords, $name if $keywords;
                push @order, $name;
                if ($token***REMOVED***SEMICOLON***REMOVED***) ***REMOVED***
                    $token***REMOVED***$name***REMOVED*** = lc $1;
                ***REMOVED*** else ***REMOVED***
                    $token***REMOVED***$name***REMOVED*** = $name;
                ***REMOVED***
            ***REMOVED***
        ***REMOVED*** else ***REMOVED***
            push @const, "";
        ***REMOVED***

    ***REMOVED***
    push @const, ")";
    print join "\n", @const, "";
***REMOVED***

***REMOVED***
    print <<_END_;

var token2string = [...]string***REMOVED***
_END_
    for my $name (@order) ***REMOVED***
        print "$name: \"$token***REMOVED***$name***REMOVED***\",\n";
    ***REMOVED***
    print <<_END_;
***REMOVED***
_END_

    print <<_END_;

var keywordTable = map[string]_keyword***REMOVED***
_END_
    for my $name (@keywords) ***REMOVED***
        print <<_END_
			"@***REMOVED***[ lc $name ]***REMOVED***": _keyword***REMOVED***
				token: $name,
			***REMOVED***,
_END_
    ***REMOVED***

    for my $name (qw/
        const
        class
        enum
        export
        extends
        import
        super
        /) ***REMOVED***
        print <<_END_
			"$name": _keyword***REMOVED***
				token: KEYWORD,
                futureKeyword: true,
			***REMOVED***,
_END_
    ***REMOVED***

    for my $name (qw/
        implements
        interface
        let
        package
        private
        protected
        public
        static
        /) ***REMOVED***
        print <<_END_
			"$name": _keyword***REMOVED***
				token: KEYWORD,
                futureKeyword: true,
                strict: true,
			***REMOVED***,
_END_
    ***REMOVED***

    print <<_END_;
***REMOVED***
_END_
***REMOVED***
